<script src="~/js/pagamento.js"></script>
<script>
    function listarPagamentos() {

        let dataIncio = $("#txtDataIncial").val();
        let dataFim = $("#txtDataFinal").val();
        if (validarPesquisaPagamento(dataIncio, dataFim)) {
            var dados = $("#frmFiltroPgt").serialize();
            $.ajax({
                url: '@Url.Action("ResultadoPagamento", "Pagamento")',
                type: 'POST',
                data: dados,
                async: true,
                success: function (response) {
                    $("#resultaPagamento").empty();
                    $("#resultaPagamento").append(response);
                },
                error: function (response) {
                    toastr.error(mensagem, "Error");
                }
            });
        }
    }

    //cadastro
    function AbrirModalParaCadastroPagamento() {

        $.ajax({
            url: '@Url.Action("Create", "Pagamento")',
            type: 'GET',
            async: true,
            success: function (response) {
                $("#formularioPagamento").empty();
                $("#formularioPagamento").append(response);
                $('input[mask = "valores"]').mask("#.##0,00", { reverse: true });
                $('#modalPagamento').modal('show')

            },
            error: function (response) {
                toastr.error("Houve um erro ao abrir formulário." + response, "Error");
            }
        });
    }

    function AbrirFormulariEdicaoPagamento(value) {
        window.value = value;

        $.ajax({
            url: '@Url.Action("Edit", "Pagamento")',
            type: 'GET',
            data: { Id: window.value },
            async: true,
            success: function (response) {
                $("#formularioPagamento").empty();
                $("#formularioPagamento").append(response);
                $('input[mask = "valores"]').mask("#.##0,00", { reverse: true });
                $('#modalPagamento').modal('show')

            },
            error: function (response) {
                toastr.error("Houve um erro na abrir formulario de Edição." + response, "Error");
            }
        });
    }

    function cadastrarEditarPagamento() {

        let dadosFormulario = $("#formularioCadastrarPagamento").serialize();
        //var action = $('input[ident-paciente ="pacienteId"]').val() > 0 ? "Edit" : "Create";
        let actionResult = $('input[ident-pagamento ="pagamentoId"]').val() > 0 ? "Edit" : "Create";
        let mensagemOperacao = actionResult == "Edit" ? "Dados do pagamento editados com sucesso" : "Pagamento cadastrado com sucesso";
        var url = actionResult == "Edit" ? '@Url.Action("Edit", "Pagamento")' : '@Url.Action("Create", "Pagamento")';
        $.ajax({
            url: url,
            type: 'POST',
            data: dadosFormulario,
            async: true,
            success: function (response) {
                //alert(response)
                $("#conteudoPagamento").empty();
                $("#conteudoPagamento").append(response);
                $('#modalPagamento').modal('hide');
                toastr.success(mensagemOperacao, "Sucesso");


            },
            error: function (response) {
                toastr.error("Erro ao tentar registrar", "Error");
            }
        });
    }

    function ExcluirPaciente(value) {
        if (value > 0) {
            Swal.fire({
                title: 'Deseja realmente deletar esse paciente ?',
                //text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sim'

            }).then((result) => {
                if (result.value) {

                    $.ajax({
                        url: '@Url.Action("Delete", "Pagamento")',
                        type: 'POST',
                        data: { Id: value },
                        async: true,
                        success: function (response) {
                            $("#Conteudo").empty();
                            $("#Conteudo").append(response);
                            toastr.success("Paciente excluido com sucesso.", "Sucesso");
                        },
                        error: function (response) {
                            toastr.error("Erro ao tentar excluir " + response, "Error");
                        }
                    });
                }
            });
        }


    }

    function ExcluirPagamento_OnClick(pagamentoId) {

        Swal.fire({
            title: 'Deseja realmente remover este pagamento ?',
            text: "Você não conseguirá mais reverter essa operação.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim'

        }).then((result) => {
            if (result.value) {
                $.post('@Url.Action("Delete", "Pagamento")', {
                    Id: pagamentoId,


                }, function (response) {
                    $("#resultaPagamento").html(response)
                    toastr.success("Pagamento removido com sucesso")
                })
                    .fail(function (error) {
                        // Handle errors here
                        console.error('Error:', error);
                    });
            }
        });
    }

</script>
